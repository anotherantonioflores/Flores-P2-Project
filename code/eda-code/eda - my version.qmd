---
title: "Exploratory Data Analysis script"
date: "2024-02-07"
output: html_document
author: Antonio Flores
---

  
  
This Quarto file loads the cleaned data and does some exploring.

# Setup
Necessary libraries for this script.
```{r}
library(here) 
library(dplyr)
library(skimr)
library(ggplot2)
library(scales)
```


Load the data.

```{r}
data_location <- here::here("data","processed-data","processeddata1.rds")
mydata <- readRDS(data_location)
```





# Data exploration through tables

Creating a summary table.

```{r}
summary_df = skimr::skim(mydata)
print(summary_df)
# save to file
summarytable_file = here("results", "tables", "summarytable1.rds")
saveRDS(summary_df, file = summarytable_file)
```

# Data exploration through figures

Histogram plots for some continuous outcomes. 

Age first.

```{r}
p1 <- mydata %>% ggplot(aes(x=age)) + geom_histogram() 
plot(p1)
figure_file = here("results", "figures","age-distribution.png")
ggsave(filename = figure_file, plot=p1) 
```

Next bank account balance.

```{r}
p2 <- mydata %>% ggplot(aes(x=balance)) + geom_histogram() + scale_x_log10(labels =label_dollar())
plot(p2)
figure_file = here("results", "figures","balance-distribution.png")
ggsave(filename = figure_file, plot=p2) 
```

Now balance as function of age

```{r}
p3 <- mydata %>% ggplot(aes(x=age, y=balance)) + geom_point() + geom_smooth(method='lm')
plot(p3)
figure_file = here("results", "figures", "age-balance-scatter.png")
ggsave(filename = figure_file, plot=p3) 
```

Now balance as function of age, stratified by the marital variable. 

```{r}
p4 <- mydata %>% ggplot(aes(x=age, y=balance, color = marital)) + geom_point() + geom_smooth(method='lm')
plot(p4)
figure_file = here("results", "figures", "age-balance-stratified.png")
ggsave(filename = figure_file, plot=p4) 
```


Next, exploring balance across different job types. 

```{r}
p5 = mydata |>
  ggplot(aes(balance, job))+
  geom_boxplot()+
  scale_x_log10(labels =label_dollar())
p5
figure_file = here("results", "figures", "job-balance-scatter.png")
ggsave(filename = figure_file, plot=p5) 

```

Now, some barplots examining job types, education level, and marital status.

```{r}
mydata |>
  ggplot(aes(job))+
  geom_bar()

mydata |>
  ggplot(aes(education))+
  geom_bar()

mydata |>
  ggplot(aes(marital))+
  geom_bar()
```

